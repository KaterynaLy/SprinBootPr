<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />
    <title>Perfil del Paciente</title>
    <script>
        async function obtenerPerfilCompleto() {
            const idPaciente = document.getElementById('pacienteId').value; // Obtener el ID del paciente desde un input
            const response = await fetch(`/api/paciente/${idPaciente}/perfil-completo`);
            
            if (response.ok) {
                const perfilCompleto = await response.json();
                mostrarPerfil(perfilCompleto);
            } else {
                alert('Error al cargar el perfil del paciente.');
            }
        }

        function mostrarPerfil(perfilCompleto) {
            const perfilDiv = document.getElementById('perfil');
            perfilDiv.innerHTML = `
                <h2>Perfil del Paciente</h2>
                <p><strong>Nombre:</strong> ${perfilCompleto.perfil.nombre} ${perfilCompleto.perfil.apellido}</p>
                <p><strong>Email:</strong> ${perfilCompleto.perfil.email}</p>
                <p><strong>Teléfono:</strong> ${perfilCompleto.perfil.telefono}</p>
                <p><strong>Dirección:</strong> ${perfilCompleto.perfil.direccion}</p>
                <p><strong>Fecha de Nacimiento:</strong> ${new Date(perfilCompleto.perfil.fechaNacimiento).toLocaleDateString()}</p>
                <p><strong>Género:</strong> ${perfilCompleto.perfil.genero}</p>
                <h3>Documentos</h3>
                <ul>${perfilCompleto.documentos.map(doc => `<li>${doc.nombre}</li>`).join('')}</ul>
                <h3>Presupuestos</h3>
                <ul>${perfilCompleto.presupuestos.map(pres => `<li>${pres.descripcion}</li>`).join('')}</ul>
                <h3>Tratamientos</h3>
                <ul>${perfilCompleto.tratamientos.map(trat => `<li>${trat.descripcion}</li>`).join('')}</ul>
            `;
        }
    </script>
     <script>
        async function agregarPaciente() {
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const email = document.getElementById('email').value;

            const response = await fetch('/api/pacientes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre, apellido, email })
            });

            if (response.ok) {
                alert('Paciente agregado con éxito');
                listarPacientes(); // Refresh the list
            } else {
                alert('Error al agregar paciente');
            }
        }

        async function listarPacientes() {
            const response = await fetch('/api/pacientes/listar');
            const pacientes = await response.json();
            const lista = document.getElementById('listaPacientes');
            lista.innerHTML = '';

            pacientes.forEach(paciente => {
                const li = document.createElement('li');
                li.textContent = `${paciente.nombre} ${paciente.apellido} - ${paciente.email} `;
                const eliminarBtn = document.createElement('button');
                eliminarBtn.textContent = 'Eliminar';
                eliminarBtn.onclick = () => eliminarPaciente(paciente.id);
                li.appendChild(eliminarBtn);
                lista.appendChild(li);
            });
        }

        async function eliminarPaciente(id) {
            const response = await fetch(`/api/pacientes/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('Paciente eliminado con éxito');
                listarPacientes(); // Refresh the list
            } else {
                alert('Error al eliminar paciente');
            }
        }

        window.onload = listarPacientes; // Load pacientes on page load
    </script>
</head>
<body>
    <h1>Consulta de Paciente</h1>
    <label for="pacienteId">ID del Paciente:</label>
    <input type="number" id="pacienteId" placeholder="Ingrese el ID del paciente">
    <button onclick="obtenerPerfilCompleto()">Obtener Perfil Completo</button>
    
    <div id="perfil"></div>
    <h1>Panel de Administrador</h1>
    <h2>Agregar Paciente</h2>
    <input type="text" id="nombre" placeholder="Nombre">
    <input type="text" id="apellido" placeholder="Apellido">
    <input type="email" id="email" placeholder="Email">
    <button onclick="agregarPaciente()">Agregar Paciente</button>

    <h2>Lista de Pacientes</h2>
    <ul id="listaPacientes"></ul>
</body>
</html>